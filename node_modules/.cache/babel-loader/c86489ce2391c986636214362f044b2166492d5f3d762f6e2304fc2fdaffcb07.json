{"ast":null,"code":"var AWS = require('../core');\n\n/**\n * @api private\n */\nvar service = null;\n\n/**\n * @api private\n */\nvar api = {\n  signatureVersion: 'v4',\n  signingName: 'rds-db',\n  operations: {}\n};\n\n/**\n * @api private\n */\nvar requiredAuthTokenOptions = {\n  region: 'string',\n  hostname: 'string',\n  port: 'number',\n  username: 'string'\n};\n\n/**\n * A signer object can be used to generate an auth token to a database.\n */\nAWS.RDS.Signer = AWS.util.inherit({\n  /**\n   * Creates a signer object can be used to generate an auth token.\n   *\n   * @option options credentials [AWS.Credentials] the AWS credentials\n   *   to sign requests with. Uses the default credential provider chain\n   *   if not specified.\n   * @option options hostname [String] the hostname of the database to connect to.\n   * @option options port [Number] the port number the database is listening on.\n   * @option options region [String] the region the database is located in.\n   * @option options username [String] the username to login as.\n   * @example Passing in options to constructor\n   *   var signer = new AWS.RDS.Signer({\n   *     credentials: new AWS.SharedIniFileCredentials({profile: 'default'}),\n   *     region: 'us-east-1',\n   *     hostname: 'db.us-east-1.rds.amazonaws.com',\n   *     port: 8000,\n   *     username: 'name'\n   *   });\n   */\n  constructor: function Signer(options) {\n    this.options = options || {};\n  },\n  /**\n   * @api private\n   * Strips the protocol from a url.\n   */\n  convertUrlToAuthToken: function convertUrlToAuthToken(url) {\n    // we are always using https as the protocol\n    var protocol = 'https://';\n    if (url.indexOf(protocol) === 0) {\n      return url.substring(protocol.length);\n    }\n  },\n  /**\n   * @overload getAuthToken(options = {}, [callback])\n   *   Generate an auth token to a database.\n   *   @note You must ensure that you have static or previously resolved\n   *     credentials if you call this method synchronously (with no callback),\n   *     otherwise it may not properly sign the request. If you cannot guarantee\n   *     this (you are using an asynchronous credential provider, i.e., EC2\n   *     IAM roles), you should always call this method with an asynchronous\n   *     callback.\n   *\n   *   @param options [map] The fields to use when generating an auth token.\n   *     Any options specified here will be merged on top of any options passed\n   *     to AWS.RDS.Signer:\n   *\n   *     * **credentials** (AWS.Credentials) &mdash; the AWS credentials\n   *         to sign requests with. Uses the default credential provider chain\n   *         if not specified.\n   *     * **hostname** (String) &mdash; the hostname of the database to connect to.\n   *     * **port** (Number) &mdash; the port number the database is listening on.\n   *     * **region** (String) &mdash; the region the database is located in.\n   *     * **username** (String) &mdash; the username to login as.\n   *   @return [String] if called synchronously (with no callback), returns the\n   *     auth token.\n   *   @return [null] nothing is returned if a callback is provided.\n   *   @callback callback function (err, token)\n   *     If a callback is supplied, it is called when an auth token has been generated.\n   *     @param err [Error] the error object returned from the signer.\n   *     @param token [String] the auth token.\n   *\n   *   @example Generating an auth token synchronously\n   *     var signer = new AWS.RDS.Signer({\n   *       // configure options\n   *       region: 'us-east-1',\n   *       username: 'default',\n   *       hostname: 'db.us-east-1.amazonaws.com',\n   *       port: 8000\n   *     });\n   *     var token = signer.getAuthToken({\n   *       // these options are merged with those defined when creating the signer, overriding in the case of a duplicate option\n   *       // credentials are not specified here or when creating the signer, so default credential provider will be used\n   *       username: 'test' // overriding username\n   *     });\n   *   @example Generating an auth token asynchronously\n   *     var signer = new AWS.RDS.Signer({\n   *       // configure options\n   *       region: 'us-east-1',\n   *       username: 'default',\n   *       hostname: 'db.us-east-1.amazonaws.com',\n   *       port: 8000\n   *     });\n   *     signer.getAuthToken({\n   *       // these options are merged with those defined when creating the signer, overriding in the case of a duplicate option\n   *       // credentials are not specified here or when creating the signer, so default credential provider will be used\n   *       username: 'test' // overriding username\n   *     }, function(err, token) {\n   *       if (err) {\n   *         // handle error\n   *       } else {\n   *         // use token\n   *       }\n   *     });\n   *\n   */\n  getAuthToken: function getAuthToken(options, callback) {\n    if (typeof options === 'function' && callback === undefined) {\n      callback = options;\n      options = {};\n    }\n    var self = this;\n    var hasCallback = typeof callback === 'function';\n    // merge options with existing options\n    options = AWS.util.merge(this.options, options);\n    // validate options\n    var optionsValidation = this.validateAuthTokenOptions(options);\n    if (optionsValidation !== true) {\n      if (hasCallback) {\n        return callback(optionsValidation, null);\n      }\n      throw optionsValidation;\n    }\n\n    // 15 minutes\n    var expires = 900;\n    // create service to generate a request from\n    var serviceOptions = {\n      region: options.region,\n      endpoint: new AWS.Endpoint(options.hostname + ':' + options.port),\n      paramValidation: false,\n      signatureVersion: 'v4'\n    };\n    if (options.credentials) {\n      serviceOptions.credentials = options.credentials;\n    }\n    service = new AWS.Service(serviceOptions);\n    // ensure the SDK is using sigv4 signing (config is not enough)\n    service.api = api;\n    var request = service.makeRequest();\n    // add listeners to request to properly build auth token\n    this.modifyRequestForAuthToken(request, options);\n    if (hasCallback) {\n      request.presign(expires, function (err, url) {\n        if (url) {\n          url = self.convertUrlToAuthToken(url);\n        }\n        callback(err, url);\n      });\n    } else {\n      var url = request.presign(expires);\n      return this.convertUrlToAuthToken(url);\n    }\n  },\n  /**\n   * @api private\n   * Modifies a request to allow the presigner to generate an auth token.\n   */\n  modifyRequestForAuthToken: function modifyRequestForAuthToken(request, options) {\n    request.on('build', request.buildAsGet);\n    var httpRequest = request.httpRequest;\n    httpRequest.body = AWS.util.queryParamsToString({\n      Action: 'connect',\n      DBUser: options.username\n    });\n  },\n  /**\n   * @api private\n   * Validates that the options passed in contain all the keys with values of the correct type that\n   *   are needed to generate an auth token.\n   */\n  validateAuthTokenOptions: function validateAuthTokenOptions(options) {\n    // iterate over all keys in options\n    var message = '';\n    options = options || {};\n    for (var key in requiredAuthTokenOptions) {\n      if (!Object.prototype.hasOwnProperty.call(requiredAuthTokenOptions, key)) {\n        continue;\n      }\n      if (typeof options[key] !== requiredAuthTokenOptions[key]) {\n        message += 'option \\'' + key + '\\' should have been type \\'' + requiredAuthTokenOptions[key] + '\\', was \\'' + typeof options[key] + '\\'.\\n';\n      }\n    }\n    if (message.length) {\n      return AWS.util.error(new Error(), {\n        code: 'InvalidParameter',\n        message: message\n      });\n    }\n    return true;\n  }\n});","map":{"version":3,"names":["AWS","require","service","api","signatureVersion","signingName","operations","requiredAuthTokenOptions","region","hostname","port","username","RDS","Signer","util","inherit","constructor","options","convertUrlToAuthToken","url","protocol","indexOf","substring","length","getAuthToken","callback","undefined","self","hasCallback","merge","optionsValidation","validateAuthTokenOptions","expires","serviceOptions","endpoint","Endpoint","paramValidation","credentials","Service","request","makeRequest","modifyRequestForAuthToken","presign","err","on","buildAsGet","httpRequest","body","queryParamsToString","Action","DBUser","message","key","Object","prototype","hasOwnProperty","call","error","Error","code"],"sources":["/Users/damianmiskow/Desktop/Projects/Synchrony-Interview-Process/node_modules/aws-sdk/lib/rds/signer.js"],"sourcesContent":["var AWS = require('../core');\n\n/**\n * @api private\n */\nvar service = null;\n\n/**\n * @api private\n */\nvar api = {\n    signatureVersion: 'v4',\n    signingName: 'rds-db',\n    operations: {}\n};\n\n/**\n * @api private\n */\nvar requiredAuthTokenOptions = {\n    region: 'string',\n    hostname: 'string',\n    port: 'number',\n    username: 'string'\n};\n\n/**\n * A signer object can be used to generate an auth token to a database.\n */\nAWS.RDS.Signer = AWS.util.inherit({\n    /**\n     * Creates a signer object can be used to generate an auth token.\n     *\n     * @option options credentials [AWS.Credentials] the AWS credentials\n     *   to sign requests with. Uses the default credential provider chain\n     *   if not specified.\n     * @option options hostname [String] the hostname of the database to connect to.\n     * @option options port [Number] the port number the database is listening on.\n     * @option options region [String] the region the database is located in.\n     * @option options username [String] the username to login as.\n     * @example Passing in options to constructor\n     *   var signer = new AWS.RDS.Signer({\n     *     credentials: new AWS.SharedIniFileCredentials({profile: 'default'}),\n     *     region: 'us-east-1',\n     *     hostname: 'db.us-east-1.rds.amazonaws.com',\n     *     port: 8000,\n     *     username: 'name'\n     *   });\n     */\n    constructor: function Signer(options) {\n        this.options = options || {};\n    },\n\n    /**\n     * @api private\n     * Strips the protocol from a url.\n     */\n    convertUrlToAuthToken: function convertUrlToAuthToken(url) {\n        // we are always using https as the protocol\n        var protocol = 'https://';\n        if (url.indexOf(protocol) === 0) {\n            return url.substring(protocol.length);\n        }\n    },\n\n    /**\n     * @overload getAuthToken(options = {}, [callback])\n     *   Generate an auth token to a database.\n     *   @note You must ensure that you have static or previously resolved\n     *     credentials if you call this method synchronously (with no callback),\n     *     otherwise it may not properly sign the request. If you cannot guarantee\n     *     this (you are using an asynchronous credential provider, i.e., EC2\n     *     IAM roles), you should always call this method with an asynchronous\n     *     callback.\n     *\n     *   @param options [map] The fields to use when generating an auth token.\n     *     Any options specified here will be merged on top of any options passed\n     *     to AWS.RDS.Signer:\n     *\n     *     * **credentials** (AWS.Credentials) &mdash; the AWS credentials\n     *         to sign requests with. Uses the default credential provider chain\n     *         if not specified.\n     *     * **hostname** (String) &mdash; the hostname of the database to connect to.\n     *     * **port** (Number) &mdash; the port number the database is listening on.\n     *     * **region** (String) &mdash; the region the database is located in.\n     *     * **username** (String) &mdash; the username to login as.\n     *   @return [String] if called synchronously (with no callback), returns the\n     *     auth token.\n     *   @return [null] nothing is returned if a callback is provided.\n     *   @callback callback function (err, token)\n     *     If a callback is supplied, it is called when an auth token has been generated.\n     *     @param err [Error] the error object returned from the signer.\n     *     @param token [String] the auth token.\n     *\n     *   @example Generating an auth token synchronously\n     *     var signer = new AWS.RDS.Signer({\n     *       // configure options\n     *       region: 'us-east-1',\n     *       username: 'default',\n     *       hostname: 'db.us-east-1.amazonaws.com',\n     *       port: 8000\n     *     });\n     *     var token = signer.getAuthToken({\n     *       // these options are merged with those defined when creating the signer, overriding in the case of a duplicate option\n     *       // credentials are not specified here or when creating the signer, so default credential provider will be used\n     *       username: 'test' // overriding username\n     *     });\n     *   @example Generating an auth token asynchronously\n     *     var signer = new AWS.RDS.Signer({\n     *       // configure options\n     *       region: 'us-east-1',\n     *       username: 'default',\n     *       hostname: 'db.us-east-1.amazonaws.com',\n     *       port: 8000\n     *     });\n     *     signer.getAuthToken({\n     *       // these options are merged with those defined when creating the signer, overriding in the case of a duplicate option\n     *       // credentials are not specified here or when creating the signer, so default credential provider will be used\n     *       username: 'test' // overriding username\n     *     }, function(err, token) {\n     *       if (err) {\n     *         // handle error\n     *       } else {\n     *         // use token\n     *       }\n     *     });\n     *\n     */\n    getAuthToken: function getAuthToken(options, callback) {\n        if (typeof options === 'function' && callback === undefined) {\n            callback = options;\n            options = {};\n        }\n        var self = this;\n        var hasCallback = typeof callback === 'function';\n        // merge options with existing options\n        options = AWS.util.merge(this.options, options);\n        // validate options\n        var optionsValidation = this.validateAuthTokenOptions(options);\n        if (optionsValidation !== true) {\n            if (hasCallback) {\n                return callback(optionsValidation, null);\n            }\n            throw optionsValidation;\n        }\n\n        // 15 minutes\n        var expires = 900;\n        // create service to generate a request from\n        var serviceOptions = {\n            region: options.region,\n            endpoint: new AWS.Endpoint(options.hostname + ':' + options.port),\n            paramValidation: false,\n            signatureVersion: 'v4'\n        };\n        if (options.credentials) {\n            serviceOptions.credentials = options.credentials;\n        }\n        service = new AWS.Service(serviceOptions);\n        // ensure the SDK is using sigv4 signing (config is not enough)\n        service.api = api;\n\n        var request = service.makeRequest();\n        // add listeners to request to properly build auth token\n        this.modifyRequestForAuthToken(request, options);\n\n        if (hasCallback) {\n            request.presign(expires, function(err, url) {\n                if (url) {\n                    url = self.convertUrlToAuthToken(url);\n                }\n                callback(err, url);\n            });\n        } else {\n            var url = request.presign(expires);\n            return this.convertUrlToAuthToken(url);\n        }\n    },\n\n    /**\n     * @api private\n     * Modifies a request to allow the presigner to generate an auth token.\n     */\n    modifyRequestForAuthToken: function modifyRequestForAuthToken(request, options) {\n        request.on('build', request.buildAsGet);\n        var httpRequest = request.httpRequest;\n        httpRequest.body = AWS.util.queryParamsToString({\n            Action: 'connect',\n            DBUser: options.username\n        });\n    },\n\n    /**\n     * @api private\n     * Validates that the options passed in contain all the keys with values of the correct type that\n     *   are needed to generate an auth token.\n     */\n    validateAuthTokenOptions: function validateAuthTokenOptions(options) {\n        // iterate over all keys in options\n        var message = '';\n        options = options || {};\n        for (var key in requiredAuthTokenOptions) {\n            if (!Object.prototype.hasOwnProperty.call(requiredAuthTokenOptions, key)) {\n                continue;\n            }\n            if (typeof options[key] !== requiredAuthTokenOptions[key]) {\n                message += 'option \\'' + key + '\\' should have been type \\'' + requiredAuthTokenOptions[key] + '\\', was \\'' + typeof options[key] + '\\'.\\n';\n            }\n        }\n        if (message.length) {\n            return AWS.util.error(new Error(), {\n                code: 'InvalidParameter',\n                message: message\n            });\n        }\n        return true;\n    }\n});\n"],"mappings":"AAAA,IAAIA,GAAG,GAAGC,OAAO,CAAC,SAAS,CAAC;;AAE5B;AACA;AACA;AACA,IAAIC,OAAO,GAAG,IAAI;;AAElB;AACA;AACA;AACA,IAAIC,GAAG,GAAG;EACNC,gBAAgB,EAAE,IAAI;EACtBC,WAAW,EAAE,QAAQ;EACrBC,UAAU,EAAE,CAAC;AACjB,CAAC;;AAED;AACA;AACA;AACA,IAAIC,wBAAwB,GAAG;EAC3BC,MAAM,EAAE,QAAQ;EAChBC,QAAQ,EAAE,QAAQ;EAClBC,IAAI,EAAE,QAAQ;EACdC,QAAQ,EAAE;AACd,CAAC;;AAED;AACA;AACA;AACAX,GAAG,CAACY,GAAG,CAACC,MAAM,GAAGb,GAAG,CAACc,IAAI,CAACC,OAAO,CAAC;EAC9B;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,WAAW,EAAE,SAASH,MAAMA,CAACI,OAAO,EAAE;IAClC,IAAI,CAACA,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;EAChC,CAAC;EAED;AACJ;AACA;AACA;EACIC,qBAAqB,EAAE,SAASA,qBAAqBA,CAACC,GAAG,EAAE;IACvD;IACA,IAAIC,QAAQ,GAAG,UAAU;IACzB,IAAID,GAAG,CAACE,OAAO,CAACD,QAAQ,CAAC,KAAK,CAAC,EAAE;MAC7B,OAAOD,GAAG,CAACG,SAAS,CAACF,QAAQ,CAACG,MAAM,CAAC;IACzC;EACJ,CAAC;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,YAAY,EAAE,SAASA,YAAYA,CAACP,OAA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"},"metadata":{},"sourceType":"script","externalDependencies":[]}