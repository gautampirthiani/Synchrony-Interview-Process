{"ast":null,"code":"var AWS = require('../core');\nvar inherit = AWS.util.inherit;\n\n/**\n * @api private\n */\nvar expiresHeader = 'presigned-expires';\n\n/**\n * @api private\n */\nfunction signedUrlBuilder(request) {\n  var expires = request.httpRequest.headers[expiresHeader];\n  var signerClass = request.service.getSignerClass(request);\n  delete request.httpRequest.headers['User-Agent'];\n  delete request.httpRequest.headers['X-Amz-User-Agent'];\n  if (signerClass === AWS.Signers.V4) {\n    if (expires > 604800) {\n      // one week expiry is invalid\n      var message = 'Presigning does not support expiry time greater ' + 'than a week with SigV4 signing.';\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidExpiryTime',\n        message: message,\n        retryable: false\n      });\n    }\n    request.httpRequest.headers[expiresHeader] = expires;\n  } else if (signerClass === AWS.Signers.S3) {\n    var now = request.service ? request.service.getSkewCorrectedDate() : AWS.util.date.getDate();\n    request.httpRequest.headers[expiresHeader] = parseInt(AWS.util.date.unixTimestamp(now) + expires, 10).toString();\n  } else {\n    throw AWS.util.error(new Error(), {\n      message: 'Presigning only supports S3 or SigV4 signing.',\n      code: 'UnsupportedSigner',\n      retryable: false\n    });\n  }\n}\n\n/**\n * @api private\n */\nfunction signedUrlSigner(request) {\n  var endpoint = request.httpRequest.endpoint;\n  var parsedUrl = AWS.util.urlParse(request.httpRequest.path);\n  var queryParams = {};\n  if (parsedUrl.search) {\n    queryParams = AWS.util.queryStringParse(parsedUrl.search.substr(1));\n  }\n  var auth = request.httpRequest.headers['Authorization'].split(' ');\n  if (auth[0] === 'AWS') {\n    auth = auth[1].split(':');\n    queryParams['Signature'] = auth.pop();\n    queryParams['AWSAccessKeyId'] = auth.join(':');\n    AWS.util.each(request.httpRequest.headers, function (key, value) {\n      if (key === expiresHeader) key = 'Expires';\n      if (key.indexOf('x-amz-meta-') === 0) {\n        // Delete existing, potentially not normalized key\n        delete queryParams[key];\n        key = key.toLowerCase();\n      }\n      queryParams[key] = value;\n    });\n    delete request.httpRequest.headers[expiresHeader];\n    delete queryParams['Authorization'];\n    delete queryParams['Host'];\n  } else if (auth[0] === 'AWS4-HMAC-SHA256') {\n    // SigV4 signing\n    auth.shift();\n    var rest = auth.join(' ');\n    var signature = rest.match(/Signature=(.*?)(?:,|\\s|\\r?\\n|$)/)[1];\n    queryParams['X-Amz-Signature'] = signature;\n    delete queryParams['Expires'];\n  }\n\n  // build URL\n  endpoint.pathname = parsedUrl.pathname;\n  endpoint.search = AWS.util.queryParamsToString(queryParams);\n}\n\n/**\n * @api private\n */\nAWS.Signers.Presign = inherit({\n  /**\n   * @api private\n   */\n  sign: function sign(request, expireTime, callback) {\n    request.httpRequest.headers[expiresHeader] = expireTime || 3600;\n    request.on('build', signedUrlBuilder);\n    request.on('sign', signedUrlSigner);\n    request.removeListener('afterBuild', AWS.EventListeners.Core.SET_CONTENT_LENGTH);\n    request.removeListener('afterBuild', AWS.EventListeners.Core.COMPUTE_SHA256);\n    request.emit('beforePresign', [request]);\n    if (callback) {\n      request.build(function () {\n        if (this.response.error) callback(this.response.error);else {\n          callback(null, AWS.util.urlFormat(request.httpRequest.endpoint));\n        }\n      });\n    } else {\n      request.build();\n      if (request.response.error) throw request.response.error;\n      return AWS.util.urlFormat(request.httpRequest.endpoint);\n    }\n  }\n});\n\n/**\n * @api private\n */\nmodule.exports = AWS.Signers.Presign;","map":{"version":3,"names":["AWS","require","inherit","util","expiresHeader","signedUrlBuilder","request","expires","httpRequest","headers","signerClass","service","getSignerClass","Signers","V4","message","error","Error","code","retryable","S3","now","getSkewCorrectedDate","date","getDate","parseInt","unixTimestamp","toString","signedUrlSigner","endpoint","parsedUrl","urlParse","path","queryParams","search","queryStringParse","substr","auth","split","pop","join","each","key","value","indexOf","toLowerCase","shift","rest","signature","match","pathname","queryParamsToString","Presign","sign","expireTime","callback","on","removeListener","EventListeners","Core","SET_CONTENT_LENGTH","COMPUTE_SHA256","emit","build","response","urlFormat","module","exports"],"sources":["/Users/damianmiskow/Desktop/Projects/Synchrony-Interview-Process/node_modules/aws-sdk/lib/signers/presign.js"],"sourcesContent":["var AWS = require('../core');\nvar inherit = AWS.util.inherit;\n\n/**\n * @api private\n */\nvar expiresHeader = 'presigned-expires';\n\n/**\n * @api private\n */\nfunction signedUrlBuilder(request) {\n  var expires = request.httpRequest.headers[expiresHeader];\n  var signerClass = request.service.getSignerClass(request);\n\n  delete request.httpRequest.headers['User-Agent'];\n  delete request.httpRequest.headers['X-Amz-User-Agent'];\n\n  if (signerClass === AWS.Signers.V4) {\n    if (expires > 604800) { // one week expiry is invalid\n      var message = 'Presigning does not support expiry time greater ' +\n                    'than a week with SigV4 signing.';\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidExpiryTime', message: message, retryable: false\n      });\n    }\n    request.httpRequest.headers[expiresHeader] = expires;\n  } else if (signerClass === AWS.Signers.S3) {\n    var now = request.service ? request.service.getSkewCorrectedDate() : AWS.util.date.getDate();\n    request.httpRequest.headers[expiresHeader] = parseInt(\n      AWS.util.date.unixTimestamp(now) + expires, 10).toString();\n  } else {\n    throw AWS.util.error(new Error(), {\n      message: 'Presigning only supports S3 or SigV4 signing.',\n      code: 'UnsupportedSigner', retryable: false\n    });\n  }\n}\n\n/**\n * @api private\n */\nfunction signedUrlSigner(request) {\n  var endpoint = request.httpRequest.endpoint;\n  var parsedUrl = AWS.util.urlParse(request.httpRequest.path);\n  var queryParams = {};\n\n  if (parsedUrl.search) {\n    queryParams = AWS.util.queryStringParse(parsedUrl.search.substr(1));\n  }\n\n  var auth = request.httpRequest.headers['Authorization'].split(' ');\n  if (auth[0] === 'AWS') {\n    auth = auth[1].split(':');\n    queryParams['Signature'] = auth.pop();\n    queryParams['AWSAccessKeyId'] = auth.join(':');\n\n    AWS.util.each(request.httpRequest.headers, function (key, value) {\n      if (key === expiresHeader) key = 'Expires';\n      if (key.indexOf('x-amz-meta-') === 0) {\n        // Delete existing, potentially not normalized key\n        delete queryParams[key];\n        key = key.toLowerCase();\n      }\n      queryParams[key] = value;\n    });\n    delete request.httpRequest.headers[expiresHeader];\n    delete queryParams['Authorization'];\n    delete queryParams['Host'];\n  } else if (auth[0] === 'AWS4-HMAC-SHA256') { // SigV4 signing\n    auth.shift();\n    var rest = auth.join(' ');\n    var signature = rest.match(/Signature=(.*?)(?:,|\\s|\\r?\\n|$)/)[1];\n    queryParams['X-Amz-Signature'] = signature;\n    delete queryParams['Expires'];\n  }\n\n  // build URL\n  endpoint.pathname = parsedUrl.pathname;\n  endpoint.search = AWS.util.queryParamsToString(queryParams);\n}\n\n/**\n * @api private\n */\nAWS.Signers.Presign = inherit({\n  /**\n   * @api private\n   */\n  sign: function sign(request, expireTime, callback) {\n    request.httpRequest.headers[expiresHeader] = expireTime || 3600;\n    request.on('build', signedUrlBuilder);\n    request.on('sign', signedUrlSigner);\n    request.removeListener('afterBuild',\n      AWS.EventListeners.Core.SET_CONTENT_LENGTH);\n    request.removeListener('afterBuild',\n      AWS.EventListeners.Core.COMPUTE_SHA256);\n\n    request.emit('beforePresign', [request]);\n\n    if (callback) {\n      request.build(function() {\n        if (this.response.error) callback(this.response.error);\n        else {\n          callback(null, AWS.util.urlFormat(request.httpRequest.endpoint));\n        }\n      });\n    } else {\n      request.build();\n      if (request.response.error) throw request.response.error;\n      return AWS.util.urlFormat(request.httpRequest.endpoint);\n    }\n  }\n});\n\n/**\n * @api private\n */\nmodule.exports = AWS.Signers.Presign;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}